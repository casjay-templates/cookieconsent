<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-css.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markup.min.js"></script>

<!-- Our Cookie Consent -->
<script src="{{ site.baseurl }}/dist/cookieconsent.min.js"></script>

<!-- Cookie Consent Initialization -->
<script>
  // Initialize cookie consent for our own site
  cookieconsent.extended.init({
    ui: {
      theme: 'github-dark',
      position: 'bottom-right',
      showPreferences: true
    },
    content: {
      header: 'ðŸª We use cookies',
      message: 'This site uses Extended Cookie Consent to demonstrate the library and analyze usage.',
      acceptAll: 'Accept All',
      rejectAll: 'Essential Only',
      acceptSelected: 'Save Preferences'
    },
    categories: {
      necessary: {
        enabled: true,
        locked: true,
        name: 'Essential',
        description: 'Required for the website to function properly.'
      },
      analytics: {
        enabled: false,
        locked: false,
        name: 'Analytics',
        description: 'Help us understand how visitors use our documentation.'
      }
    },
    analytics: {
      enabled: true,
      gtag: true
    },
    callbacks: {
      onAcceptAll: function(categories) {
        console.log('âœ… All cookies accepted');
        if (window.gtag && categories.analytics) {
          gtag('consent', 'update', {
            'analytics_storage': 'granted',
            'ad_storage': 'granted'
          });
        }
      },
      onRejectAll: function(categories) {
        console.log('âŒ Non-essential cookies rejected');
        if (window.gtag) {
          gtag('consent', 'update', {
            'analytics_storage': 'denied',
            'ad_storage': 'denied'
          });
        }
      }
    }
  });
  
  // Demo functionality for homepage
  function showDemo(type) {
    // Clear existing consent
    localStorage.removeItem('cc_categories');
    const existing = document.querySelector('.cc-popup-extended');
    if (existing) existing.remove();
    
    setTimeout(() => {
      const demos = {
        'dracula': {
          ui: { theme: 'dracula', position: 'center', backdrop: true },
          content: { header: 'ðŸ§› Dracula Theme Demo', message: 'Beautiful dark theme with purple accents!' }
        },
        'github': {
          ui: { theme: 'github-light', position: 'bottom-bar' },
          content: { header: 'ðŸ™ GitHub Theme Demo', message: 'Clean and professional GitHub-inspired design.' }
        },
        'material': {
          ui: { theme: 'material-dark', position: 'center-modal', backdrop: true },
          content: { header: 'ðŸŽ¨ Material Design Demo', message: 'Google\'s Material Design principles in action.' }
        }
      };
      
      cookieconsent.extended.init(demos[type] || demos.dracula);
    }, 100);
  }
  
  // Make demo function available globally
  window.showDemo = showDemo;
  
  // Smooth scrolling for anchor links
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
      e.preventDefault();
      const target = document.querySelector(this.getAttribute('href'));
      if (target) {
        target.scrollIntoView({
          behavior: 'smooth',
          block: 'start'
        });
      }
    });
  });
  
  // Add copy functionality to code blocks
  document.querySelectorAll('pre code').forEach((block) => {
    const button = document.createElement('button');
    button.className = 'btn btn-sm btn-outline-light position-absolute';
    button.style.top = '10px';
    button.style.right = '10px';
    button.innerHTML = '<i class="fas fa-copy"></i>';
    button.title = 'Copy code';
    
    const pre = block.parentElement;
    pre.style.position = 'relative';
    pre.appendChild(button);
    
    button.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(block.textContent);
        button.innerHTML = '<i class="fas fa-check"></i>';
        button.className = 'btn btn-sm btn-success position-absolute';
        setTimeout(() => {
          button.innerHTML = '<i class="fas fa-copy"></i>';
          button.className = 'btn btn-sm btn-outline-light position-absolute';
        }, 2000);
      } catch (err) {
        console.error('Failed to copy: ', err);
      }
    });
  });

  // Performance monitoring
  if ('performance' in window) {
    window.addEventListener('load', function() {
      setTimeout(function() {
        const perfData = performance.getEntriesByType('navigation')[0];
        console.log('ðŸš€ Page loaded in', Math.round(perfData.loadEventEnd - perfData.fetchStart), 'ms');
      }, 0);
    });
  }
</script>

<!-- Custom page scripts -->
{% if page.custom_js %}
  {% for js_file in page.custom_js %}
    <script src="{{ site.baseurl }}/assets/js/{{ js_file }}.js"></script>
  {% endfor %}
{% endif %}